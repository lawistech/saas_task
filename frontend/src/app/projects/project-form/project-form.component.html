<div class="form-modal-overlay"> <!-- Renamed -->
  <div class="form-modal-panel"> <!-- Renamed -->
    <header class="modal-header"> <!-- Changed to header -->
      <h2>{{ formTitle }}</h2>
      <!-- Standardized close button -->
      <button type="button" class="btn btn-icon close-modal-btn" (click)="onCancel()" aria-label="Close form">✕</button>
    </header>

    <form (ngSubmit)="onSubmit()" class="form-content-area"> <!-- Added class for padding -->
      <div class="form-group">
        <label for="project-form-name">Project Name *</label> <!-- Changed id for uniqueness -->
        <input
          type="text"
          id="project-form-name"
          name="name"
          [(ngModel)]="formData.name"
          required
          placeholder="Enter project name">
      </div>

      <div class="form-group">
        <label for="project-form-description">Description</label> <!-- Changed id -->
        <textarea
          id="project-form-description"
          name="description"
          [(ngModel)]="formData.description"
          rows="4"
          placeholder="Enter project description"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="project-form-status">Status</label> <!-- Changed id -->
          <select id="project-form-status" name="status" [(ngModel)]="formData.status">
            <option value="active">Active</option>
            <option value="on_hold">On Hold</option>
            <option value="completed">Completed</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>

        <div class="form-group" *ngIf="!isSalesPipeline">
          <label for="project-form-budget">Budget</label> <!-- Changed id -->
          <input
            type="number"
            id="project-form-budget"
            name="budget"
            [(ngModel)]="formData.budget"
            placeholder="Enter budget amount">
        </div>

        <div class="form-group" *ngIf="isSalesPipeline">
          <label for="project-form-sales-stage">Sales Stage</label> <!-- Changed id -->
          <select id="project-form-sales-stage" name="sales_stage" [(ngModel)]="formData.sales_stage">
            <option *ngFor="let stage of salesStages" [value]="stage">{{ stage }}</option>
          </select>
        </div>
      </div>

      <div *ngIf="isSalesPipeline" class="sales-pipeline-fields"> <!-- Added wrapper for clarity -->
        <div class="form-row">
          <div class="form-group">
            <label for="project-form-deal-value">Deal Value</label> <!-- Changed id -->
            <input
              type="number"
              id="project-form-deal-value"
              name="deal_value"
              [(ngModel)]="formData.deal_value"
              placeholder="Enter deal value">
          </div>

          <div class="form-group">
            <label for="project-form-deal-owner">Deal Owner</label> <!-- Changed id -->
            <input
              type="text"
              id="project-form-deal-owner"
              name="deal_owner"
              [(ngModel)]="formData.deal_owner"
              placeholder="Enter deal owner">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="project-form-expected-close-date">Expected Close Date</label> <!-- Changed id -->
            <input
              type="date"
              id="project-form-expected-close-date"
              name="expected_close_date"
              [(ngModel)]="formData.expected_close_date">
          </div>
           <div class="form-group"></div> <!-- Empty div for spacing if needed, or remove if not -->
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="project-form-start-date">Start Date</label> <!-- Changed id -->
          <input
            type="date"
            id="project-form-start-date"
            name="start_date"
            [(ngModel)]="formData.start_date">
        </div>

        <div class="form-group">
          <label for="project-form-end-date">End Date</label> <!-- Changed id -->
          <input
            type="date"
            id="project-form-end-date"
            name="end_date"
            [(ngModel)]="formData.end_date">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="project-form-client-name">Client Name</label> <!-- Changed id -->
          <input
            type="text"
            id="project-form-client-name"
            name="client_name"
            [(ngModel)]="formData.client_name"
            placeholder="Enter client name">
        </div>

        <div class="form-group">
          <label for="project-form-client-email">Client Email</label> <!-- Changed id -->
          <input
            type="email"
            id="project-form-client-email"
            name="client_email"
            [(ngModel)]="formData.client_email"
            placeholder="Enter client email">
        </div>
      </div>

      <section class="custom-fields-section"> <!-- Changed to section -->
        <h3>Custom Fields</h3>
        <div *ngFor="let key of customFieldKeys; let i = index" class="form-row custom-field-row">
          <div class="form-group custom-field-key">
            <label [for]="'project-form-custom_key_' + i">Field Name {{i+1}}</label> <!-- Changed id -->
             <input
                type="text"
                [id]="'project-form-custom_key_' + i"
                [value]="key"
                readonly
                placeholder="Field Name (e.g., Priority)">
          </div>
          <div class="form-group custom-field-value">
            <label [for]="'project-form-custom_value_' + i">Value for {{key}}</label> <!-- Changed id -->
            <div class="input-with-action">
              <input
                type="text"
                [id]="'project-form-custom_value_' + i"
                [name]="'custom_value_' + key"
                [(ngModel)]="formData.custom_fields![key]"
                placeholder="Enter value">
              <!-- Standardized remove button -->
              <button type="button" class="btn btn-icon btn-danger-icon remove-custom-field-btn" (click)="removeCustomField(key)" aria-label="Remove custom field">✕</button>
            </div>
          </div>
        </div>

        <div class="add-custom-field-controls"> <!-- Renamed -->
          <h4>Add New Custom Field</h4>
          <div class="form-row">
            <div class="form-group">
              <label for="project-form-new-custom-field-key">New Field Name</label> <!-- Changed id -->
              <input
                type="text"
                id="project-form-new-custom-field-key"
                [(ngModel)]="newCustomFieldKey"
                name="newCustomFieldKey"
                placeholder="Enter field name">
            </div>
            <div class="form-group">
              <label for="project-form-new-custom-field-value">New Field Value</label> <!-- Changed id -->
              <input
                type="text"
                id="project-form-new-custom-field-value"
                [(ngModel)]="newCustomFieldValue"
                name="newCustomFieldValue"
                placeholder="Enter field value">
            </div>
          </div>
          <!-- Standardized add button -->
          <button type="button" class="btn btn-secondary add-custom-field-btn" (click)="addCustomField()">Add Custom Field</button>
        </div>
      </section>

      <div class="form-actions">
        <!-- Standardized buttons -->
        <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Saving...' : (project ? 'Update Project' : 'Create Project') }}
        </button>
      </div>
    </form>
  </div>
</div>
